<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Pleiades</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <link href='http://fonts.googleapis.com/css?family=Arapey:400,400italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <style>
            body {
                padding-top: 60px;
                padding-bottom: 40px;
            }
        </style>
        <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4.4/leaflet.css" />
        <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
        <script src='http://isawnyu.github.com/awld-js/lib/requirejs/require.min.js' type='text/javascript'></script>
        <script src='http://isawnyu.github.com/awld-js/awld.js?autoinit' type='text/javascript'></script>
        
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <ul class="nav">
                        <li><a href="./index.html">Home</a></li>
                        <li><a href="visit.html">Visit</a></li>
                    </ul>
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <div class="nav-collapse collapse">
                        <ul class="nav">
                            <li><a href="checklist.html">On Display</a></li>
                            <li><a href="online.html">Online</a></li>

                            <li><a href="events.html">Public Events</a></li>
                            <li><a href="curators.html">Curators</a></li>
                            <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Additional Information <b class="caret"></b></a>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                                    <li><a href="glossary.html">glossary</a></li>
                                    <li><a href="banners.html">banners</a></li>
                                    <li><a href="#">foe</a></li>
                                </ul></li>
                            <li><a href="press.html">Press</a></li>
                        </ul>
                    </div><!--/.nav-collapse -->
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row-fluid">  
                <div class="span9">
                    <h2>Pleiades: A Community-built gazetteer and graph of ancient places</h2>
                </div>
            </div> <!-- row -->

            <div class="row-fluid">
                <div class="span3">
                    <p>The <i class="title">Pleiades</i> gazetteer is a joint project of <a
                    href="http://isaw.nyu.edu">ISAW</a> and the <a href="http://awmc.unc.edu">Ancient
                    World Mapping Center at the University of North Carolina at Chapel Hill</a>. It currently provides information about more than 34,000 ancient places relevant to the history of Europe, North Africa and Western and Central Asia.</p>
                    <p>The map on this page automatically cycles through a random subset of <span class="title">Pleiades</span> places. You can view <span class="title">Pleiades</span> content by clicking on one of the placenames that appears in the callout box on the map. Or you might care to start exploring by visiting one of the following places:</p>
                    <ul>
                      <li><a href="http://pleiades.stoa.org/places/776235">Amheida (ancient Trimithis)</a> in Egypt</li>
                      <li><a href="http://pleiades.stoa.org/places/638753">Aphrodisias</a> in Turkey</li>
                      <li><a href="http://pleiades.stoa.org/places/91358">Hadrian's Wall</a></li>
                      <li><a href="http://pleiades.stoa.org/places/472014">The island of Sardinia</a></li>
                      <li><a href="http://pleiades.stoa.org/places/59668">Kapisa (Alexandria in the Caucasus)</a>, northeast of Bagram, Afghanistan</li>
                    </ul>
                    <p><span class="title">Pleiades</span> is described in more detail on one of the banners displayed in the exhibition galleries (and reproduced here online): "<a href="banner10.html"><span class="title">Pleiades</span> and <span class="title">Pelagios</span>: Organizing Ancient Geography Online</a>."</p>
                    <div>
                      <p class="caption"><strong><span class="title">Pleiades</span> has been funded, in part, by grants from:</strong></p>
                      <div class="span6">
                        <p class="caption"><a href="http://www.neh.gov" title="The National Endowment for the Humanities"><img class="rightgap" src="img/neh/badge.jpg" alt="Logo of the National Endowment for the Humanities"/></a></p>
                      </div>
                      <div class="span6">
<p class="caption">Any views, findings, conclusions, or recommendations expressed in this publication do not necessarily reflect those of the National Endowment for the Humanities.</p>
                      </div>
                      
                    </div>
                    
                </div>
                <div class="span9 leftgap">
                    <div id="map"></div>
                    <p class="caption">Press P to pause/play, J to go back one step, or K to advance. Press Esc to terminate the slideshow. Reload the page to begin again.</p>
                </div>
            </div>
            
            <hr />

            <footer>
                <div id="left-footer">
                    <div id="logo-footer"><a onclick="window.open(this.href);return false;" href="http://www.nyu.edu/isaw/"><img src="img/isaw-logo-ftr.png" alt="ISAW logo" title="Visit the home page of the Institute for the Study of the Ancient World"/></a></div>
                    <p><a onclick="window.open(this.href);return false;" href="http://www.nyu.edu/isaw/">Institute for the Study of the Ancient World</a>
                        <br/> New York University
                        <br/>15 East 84th Street, New York City</p>
                    <p><a href="visit.html">FREE ADMISSION</a>
                        <br/><a href="visit.html">FREE GUIDED TOURS FRIDAYS, 6PM</a></p>
                </div>
                <div id="right-footer">
                    <p>Unless otherwise indicated, all content is<br/>Copyright New York
                        University.<br/>All rights reserved.</p>
                    <p><a href="http://www.addthis.com/bookmark.php" style="text-decoration:none;" class="addthis_button">Click to bookmark or share</a></p>
                    <script type="text/javascript" xml:space="preserve">var addthis_config = {"data_track_clickback":true};</script>
                    <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#username=paregoriosisaw" xml:space="preserve"/>
                </div>
            </footer>

        </div> <!-- /container -->

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.1.min.js"><\/script>')</script>

        <script src="js/vendor/bootstrap.min.js"></script>

        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>
  <!-- Map info window content template -->
  <div id="infoWindowContent" style="display:none">
    <div id="iwcContainer" class="align-center">
      <p id="iwcTitle">
        <span class="title">
          <a id="detailsLink" href="#" title="Click for details">Title</a>
        </span>
      </p>
      <p id="iwcByline" class="byline">Last Modified 2011-01-01 by sgillies</p>
      <p id="iwcDescription">Description</p>
    </div>
  </div>

  <script>
      /* Get count of places from API status */
      $.getJSON(
        "http://pleiades.stoa.org/api/status", 
        function(data) {
          $("#placesSearchLegend", document).text(
            "Search the " +
            data['num_places'].toString().replace(
              /\B(?=(?:\d{3})+(?!\d))/g, ",") +
            " Places" );
          $("#placesSearchLegend", document).css("visibility", "visible");
        });
  </script>
  <script src="http://cdn.leafletjs.com/leaflet-0.4.4/leaflet.js"></script>
  <script>
    var latlng0 = new L.LatLng(35.0, 20.0);
    
    /* Map is initialized in the show() function below */
    var map = null;
    
    var tiles = L.tileLayer(
    //    'http://static.ahlfeldt.se/srtm/imperium/{z}/{x}/{y}.png', {
        'http://api.tiles.mapbox.com/v3/isawnyu.map-p75u7mnj/{z}/{x}/{y}.png', {
            maxZoom: 7
            });
            
    var placeIcon = new L.Icon({
        iconUrl: "http://atlantides.org/images/justice-blue.png" });
    var marker = new L.Marker([-90, 45], {icon: placeIcon});

    var msg = null;
    var infoWindow = new L.Popup({
        offset: new L.Point(16, 3),
        closeButton: false,
        maxWidth: 280 });

    var current = null;
    var next = [];
    var prev = [];

    var timer = null;
    var count = 0;
    var limit = 100;
    var interval = 12000;
    
    /* Begin in recent-seeking state */
    var state = "recent-seeking";
    var url = "http://pleiades.stoa.org/api/ssdRecentPlaceJson";

    function play() {
      
      if (count > limit) {
        if (state == "recent-seeking") { // switch state
          state = "any-seeking";
          count = 0;
          url = "http://pleiades.stoa.org/api/ssdAnyPlaceJson";
        }
        else { // quit
          current = null;
          return null;
        }
      }
      if (current != null) {
        prev.push(current);
      }
      if (next.length == 0) {
        $.getJSON(url, function(data) {
          limit = data['limit'];
          current = data['results'][0]['id'];
          if ($.inArray(current, prev) < 0 && 
              $.inArray(current, next) < 0) {
            show(data['results'][0]);
          }
          else {
            current = data['results'][1]['id'];
            show(data['results'][1]);
          }
        });
      }
      else {
        current = next.shift();
        var nextUrl = "http://pleiades.stoa.org/places/" + current + "/json";
        $.getJSON(nextUrl, function(data) {
          current = data["id"];
          show(data);
        });
      }
      count = count + 1;
      timer = setTimeout(play, interval);
    }

    function forward() {
      if (current != null) { prev.push(current); }
      if (next.length == 0) {
        $.ajax({
          url: url,
          dataType: 'json',
          headers: {'If-None-Match': '*'},
          success: function(data) {
            limit = data['limit'];
            current = data['results'][0]['id'];
            if ($.inArray(current, prev) < 0 && 
                $.inArray(current, next) < 0) {
              show(data['results'][0]);
            }
            else {
              current = data['results'][1]['id'];
              show(data['results'][1]);
            }
          }
        });
      }
      else {
        current = next.shift();
        var nextUrl = "http://pleiades.stoa.org/places/" + current + "/json";
        $.getJSON(nextUrl, function(data) {
          current = data["id"];
          show(data);
        });
      }
    }

    function back() {
      if (current != null) { next.unshift(current); }
      if (prev.length > 0) {
        current = prev.pop();
        var backUrl = "http://pleiades.stoa.org/places/" + current + "/json";
      }
      else {
        return null;
      }
      $.getJSON(backUrl, function(data) {
        current = data["id"];
        show(data);
      });
    }

    function show(data) {

      var bounds = data["bbox"];
      if (bounds == null) {
        latlng = latlng0;
      }
      else {
        latlng = new L.LatLng(
          (bounds[1]+bounds[3])/2.0, (bounds[0]+bounds[2])/2.0);
      }

      if (map == null) {
        map = L.map('map', {
          center: latlng,
          zoom: 6,
          closePopupOnClick: false,
          dragging: false,
          touchZoom: false,
          scrollWheelZoom: false,
          doubleClickZoom: false,
          boxZoom: false,
          keyboard: false,
          zoomControl: false,
          attributionControl: false });
        tiles.addTo(map);
        marker.addTo(map);
      }

      map.closePopup();
      var msg = $("#infoWindowContent").clone(true, true);
      var link = "http://pleiades.stoa.org/places/" + data["id"];
      $("#iwcTitle #detailsLink", msg).attr("href", link);
      $("#iwcTitle #detailsLink", msg).text(data["title"]);
      $("#iwcDescription", msg).text(data["description"]);

      if (data["recent_changes"] != null) {
        var items = $.map(data["recent_changes"], function(value){
          var q = value["modified"];
          var modified = new Date(
            Date.UTC(
              parseInt(q.substring(0,4)),
              parseInt(q.substring(5,7))-1,
              parseInt(q.substring(8,10)),
              parseInt(q.substring(11,13)),
              parseInt(q.substring(14,16))))
          return modified.toDateString() + " by " + value["principal"];
          });
        $("#iwcByline", msg).text("Last modified: " + items.join(", "));
      }
      else {
        $("#iwcByline", msg).hide();
      }

      $(msg).show();
      $("iwcNav", msg).hide();
      
      infoWindow.setLatLng(latlng);
      infoWindow.setContent($(msg).html());
      
      marker.setLatLng(latlng);
      map.openPopup(infoWindow);

      if (bounds == null) {
        map.panTo([latlng.lat+2.0, latlng.lng]);
        map.setZoom(5);
      }
      else {
        map.panTo([latlng.lat+1.2, latlng.lng]);
        map.setZoom(6);
      }
    }

    $(document).keyup(function(e) {
      if (e.keyCode == 27) { count = limit + 1; } // esc ends the slideshow
      /* Toggle pause/play with p key */
      else if (e.keyCode == 80) {
        if (timer == null) {
          timer=setTimeout(play, 500);
        }
        else {
          clearTimeout(timer);
          timer = null;
        }
      }
      else if (e.keyCode == 74) { back(); } // j goes back
      else if (e.keyCode == 75) { forward(); } // j goes forward
    });

    $(document).ready(function(){play();});

  </script>

        <script>
            var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src='//www.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
    </body>
</html>
